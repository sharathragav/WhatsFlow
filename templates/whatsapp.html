{% extends "base.html" %}

{% block title %}WhatsApp Connection - WhatsApp Marketing{% endblock %}

{% block content %}
<div id="toast"></div>

<div class="container-fluid py-4">
    <!-- Page Header -->
    <div class="mb-4">
        <h2 class="page-title">WhatsApp Connection</h2>
    </div>

    <!-- Connection Status -->
    <div class="dashboard-card mb-4">
        <div class="card-body text-center">
            <div class="connection-status mb-4">
                <div class="status-indicator status-disconnected" id="connectionStatus">
                    <i class="fas fa-exclamation-circle"></i>
                </div>
                <h4 class="status-text mt-3" id="statusText">Disconnected</h4>
                <p class="text-muted" id="statusDescription">Waiting for WhatsApp service...</p>
            </div>
            
            <div class="spinner-border text-success mb-3" role="status" id="loadingSpinner">
                <span class="visually-hidden">Loading...</span>
            </div>
            
            <div class="btn-group" role="group">
                <button class="btn btn-primary" id="getQrBtn"><i class="fas fa-qrcode me-1"></i>Get QR Code</button>
                <button class="btn btn-info" id="refreshBtn"><i class="fas fa-sync-alt me-1"></i>Refresh Status</button>
                <button class="btn btn-danger" id="disconnectBtn"><i class="fas fa-power-off me-1"></i>Disconnect</button>
            </div>
        </div>
    </div>

    <!-- Connection Instructions -->
    <div class="row">
        <div class="col-md-8">
            <div class="dashboard-card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-info-circle me-2"></i>WhatsApp Marketing Guidelines
                    </h5>
                </div>
                <div class="card-body">
                    <div class="guidelines-list">
                        <div class="guideline-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Only send messages to customers who have opted-in
                        </div>
                        <div class="guideline-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Respect WhatsApp's messaging policies and rate limits
                        </div>
                        <div class="guideline-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Customers can reply 'STOP' to opt-out anytime
                        </div>
                        <div class="guideline-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Include clear unsubscribe instructions in your messages
                        </div>
                        <div class="guideline-item">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            Keep messages relevant and valuable to recipients
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="dashboard-card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-qrcode me-2"></i>QR Code Scanner
                    </h5>
                </div>
                <div class="card-body text-center">
                    <div id="qrCodeArea" class="qr-placeholder mb-3">
                        <i class="fab fa-whatsapp fa-4x text-muted"></i>
                        <p id="qrCodeText" class="text-muted mt-2">QR Code will appear here when scanning is needed</p>
                    </div>
                    <img id="qrCodeImage" style="display: none; max-width: 100%; height: auto; border-radius: 8px;" alt="WhatsApp QR Code">
                    <p class="text-muted small mt-3">Use the buttons above to manage your connection. The QR code will appear here when needed.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Connection History -->
    <div class="dashboard-card mt-4">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-history me-2"></i>Connection History
            </h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Duration</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody id="connectionHistory">
                        <tr>
                            <td colspan="4" class="text-center text-muted">No connection history available</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/whatsapp.js') }}"></script>
{% endblock %}
